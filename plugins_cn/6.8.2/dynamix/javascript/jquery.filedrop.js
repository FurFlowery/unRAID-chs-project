/* jquery-filedrop. Version: 0.1.0 Author: Weixi Yen Copyright (c) 2010 Resopollution */
/* Adapted by Bergware for use in Unraid OS6 (June 2015) */
!function(e){var r=jQuery.event.fixHooks.drop;r?r.props?r.props.push("dataTransfer"):r.props=["dataTransfer"]:jQuery.event.fixHooks.drop={props:["dataTransfer"]};var t,n,a={},o={url:"",refresh:1e3,paramname:"userfile",maxfiles:25,maxfilesize:1024,data:{},drop:x,dragEnter:x,dragOver:x,dragLeave:x,docEnter:x,docOver:x,docLeave:x,beforeEach:x,afterAll:x,rename:x,error:function(e,r,t){alert(e)},uploadStarted:x,uploadFinished:x,progressUpdated:x,speedUpdated:x},i=["BrowserNotSupported","TooManyFiles","FileTooLarge"],d=!1,u=0;function s(e){return a.drop(e),null==(n=e.dataTransfer.files)?(a.error(i[0]),!1):(u=n.length,e.preventDefault(),function(){if(d=!1,!n)return a.error(i[0]),!1;var e=0,r=0;if(u>a.maxfiles)return a.error(i[1]),!1;for(var t=0;t<u;t++){if(d)return!1;try{if(0!=(p=n[t],a.beforeEach(p))){if(t===u)return;var o=new FileReader,s=1024*a.maxfilesize;if(o.index=t,n[t].size>s){a.error(i[2],n[t],t),r++;continue}o.onloadend=c,o.readAsDataURL(n[t])}else r++}catch(e){return a.error(i[0]),!1}}var p;function c(t){null==t.target.index&&(t.target.index=function(e){for(var r=0;r<u;r++)if(n[r].size==e)return r;return}(t.total));var o,i,s=new XMLHttpRequest,p=s.upload,c=n[t.target.index],v=t.target.index,g=(new Date).getTime();newName=(i=c.name,a.rename(i)),o="string"==typeof newName?f(newName,t.target.result):f(c.name,t.target.result),p.index=v,p.file=c,p.downloadStartTime=g,p.currentStart=g,p.currentProgress=0,p.startData=0,p.addEventListener("progress",l,!1),s.open("POST",a.url,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(o),a.uploadStarted(v,c,u),s.onload=function(){if(s.responseText){var t=(new Date).getTime(),n=t-g,o=a.uploadFinished(v,c,s.responseText,n);++e==u-r&&a.afterAll(),!1===o&&(d=!0)}}}return 0==r}())}function f(r,t){var n=[];return e.each(a.data,function(e,r){"function"==typeof r&&(r=r()),n.push(e+"="+r)}),n.push("filename="+encodeURI(r)),n.push("filedata="+t),n.join("&")}function l(e){if(e.lengthComputable){var r=Math.round(100*e.loaded/e.total);if(this.currentProgress!=r){this.currentProgress=r,a.progressUpdated(this.index,this.file,this.currentProgress);var t=(new Date).getTime(),n=t-this.currentStart;if(n>=a.refresh){var o=(e.loaded-this.startData)/n;a.speedUpdated(this.index,this.file,o),this.startData=e.loaded,this.currentStart=t}}}}function p(e){clearTimeout(t),e.preventDefault(),a.dragEnter(e)}function c(e){clearTimeout(t),e.preventDefault(),a.docOver(e),a.dragOver(e)}function v(e){clearTimeout(t),a.dragLeave(e),e.stopPropagation()}function g(e){return e.preventDefault(),a.docLeave(e),!1}function h(e){return clearTimeout(t),e.preventDefault(),a.docEnter(e),!1}function m(e){return clearTimeout(t),e.preventDefault(),a.docOver(e),!1}function T(e){t=setTimeout(function(){a.docLeave(e)},200)}function x(){}e.fn.filedrop=function(r){a=e.extend({},o,r),this.bind("drop",s).bind("dragenter",p).bind("dragover",c).bind("dragleave",v),e(document).bind("drop",g).bind("dragenter",h).bind("dragover",m).bind("dragleave",T)}}(jQuery);